# Συνεργατική χαρτογράφηση των δρόμων της Κέρκυρας

Με τη χρήση του Google Maps Javascript API καλούμαστε να αναπτύξουμε μια web εφαρμογή που θα επιτρέπει την προσθήκη μονοπατιών στη πόλη της Κέρκυρας και της αξιολόγησης του από τους χρήστες. Κατά την εκπόνηση της εργασίας ερχόμαστε σε επαφή με ενδιαφέρονται κομμάτια του προγραμματισμού στο διαδίκτυο όπως είναι τα API, η χρήση,επεξεργασία και αποθήκευση JSON/GeoJSON, η πλατφόρμα βάσης δεδομένων της Google (Firebase) αλλά και την ανάπτυξη υβριδικών εφαρμογών. Η παρούσα αναφορά θα περιλαμβάνει επεξήγηση του τρόπου με το οποίο αντιμετωπίστηκαν τα ζητούμενα κάθε παραδοτέου, τυχόν προβλήματα που παρουσιάστηκαν κατά την διαδικασία της ανάπτυξης της εφαρμογής, κάποια screenshot και τέλος αναφορά πηγών.

# Τρόπος επίλυσης

## Παραδοτέο 1

* Κεντράρισμα στη πόλη της Κέρκυρας.

Μετά από αναζήτηση στο διαδίκτυο, βρέθηκαν οι συντεταγμένες της πόλης της Κέρκυρας και αποθηκεύτην στις αντίστοιχες μεταβλητές. Στη συνέχεια, οι μεταβλητές αυτές,μαζί με το zoom = 15 για να εστιάσει η ιστοσελίδα κατευθέιαν στην πόλη, απδοόθηκαν στο κέντρο των options που παίρνει η αρχικοποίηση του χάρτη μέσω του API.

* Εν' αλλάξ εμφάνιση/απόκρυψη του GeoJson

Χειρισμός του κουμπιού από τη Javascript μέσω του id που του αποδόθηκε και η αλλαγή του css property display από none σε block και το αντίστροφο ανάλογα με το ποιο είναι επιλεγμένο όταν γίνει το κλικ του κουμπιού

* Καταγραφή μονοπατιών

Το παρόν κομμάτι δεν είχε να κάνει με ανάπτυξη λογισμικού καθώς το API από μόνο του μας δίνει την δυνατότητα να ενεργοποιήσουμε την λειτουργικότητα της καταγραφής μονοπατιών να γίνονται με το ποντίκι στην ήδη υπάρχουσα ιστοσελίδα. Κάθε ένα μονοπάτι που δημιουργείτε, αποθηκεύεται στο GeoJson αρχείο το οποίο είναι διαθέσιμο για download. Για το αρχείο αυτό έχει ήδη γίνει pull request στο κεντρικό αποθετήριο του κώδικα

* Διαγραφή μονοπατιών 

Υπάρχουν 2 κουμπιά στο navigation του web app. Το ένα διαγράφει όλα τα μονοπάτια από το χάρτη ενώ το άλλο διαγραφεί μόνο το μονοπάτι το οποίο έχει επιλέξει ο χρήστης με αριστερό κλικ

* Σύστημα αξιολόγησης

Αφού εμφανιστούν τα μονοπάτια τα οποία έχουν σχεδιαστεί, μπορούν να αξιολογηθούν με βαθμούς που κυμαίνονται από 1-5. Μαζί με την αύξηση της βαθμολογίας αλλάζει και το χρώμα του μονοπατιού έτσι ώστε να φαίνεται ότι τα μονοπάτια και συνεπώς οι αξιολογήσεις τους είναι μεταξύ τους διαφορετικές. Τα χρώματα επιλέχθηκαν από τα χρώματα που προτείνει η Google για material design. 

Για να γίνει δυνατή η αξιολόγηση κάθε μονοπατιού πρέπει να δημιουργηθεί για κάθε feauture ένα καινούριο property (εμείς δημιουργούμε 2 γιατί θέλουμε κια την αλλαγή του χρώματος, αλλά επί της ουσίας, για το σύστημα της αξιολόγησης αρκεί μόνο ένα). Το property αυτό λέγεται pathRating και η τιμή του αλλάζει κάθε φορά που ο χρήστης κάνει δεξί κλικ πάνω σε ένα path.

Κάθε φορά που αλλάζει η βαθμολογία και το χρώμα ενός μονοπατιού, αμέσως ανανεώνεται και το geoJson αρχείο το οποίο είναι διαθέσιμο για εκ νέου download.

* GeoJson αξιολογημένων μονοπατιών

Αφού γίνει η αξιολόγηση των μονοπατιών, μπορεί να γίνει εκ νέου download του geojson αρχείου. Για το αρχείο αυτό έχει ήδη γίνει pull request.

## Παραδοτέο 2

* Προσθήκη Βάσης Δεδομένων Firebase

Η firebase είναι μια πλατφόρμα βάσεων δεδομένων που δίνει η google η οποία διαφοροποιείται από τις άλλες βάσεις δεδομένων που είναι γνωστές σε εμάς διότι δεν είναι σχεδιασμένες γύρω από πίνακες αλλά στηρίζονται σε JSON. Αφού γίνει εγγραφή στο Firebase, η google μας δίνει έτοιμο τον κώδικα που χρειαζόμαστε για να συνδέσουμε την web ερφαρμογή μας με τη βάση.

* Μετατροπή web εφαρμογής σε android εφαρμογή.

Για να γίνει αυτή η μετατροπή πραγματικότητα, προσωπικά χρησιμοποίησα ένα hybrid app framework, το PhoneGap. Ο μόνος λόγος που επιλέχθηκε αυτό έναντι άλλων (πχ. Native Reactive, Ionic κά) είναι γιατί το phonegap λειτουργεί και με pure vanilla javascript έναντι των άλλων που συνήθως απαιτούν React js ή Angular. Κατά την ανάπτυξη της εφαρμογής τοπικά στον προσωπικό μου υπολογιστή δεν εμφανίστηκαν προβλήματα. Δυστυχώς όμως εμφανίστηκαν προβλήματα κατά το 'τρέξιμο' του apk στη κινητή μου συσκευή. Αναφορά σε αυτά θα γίνει παρακάτω.

### Πώς δουλέυει το phonegap?

Το phonegap δίνει στον developer 2 βασικά προγράμματα. Ένα που εγκαθιστά στον υπολογιστή του και ένα που εγκαθιστά στην κινητή του συσκευή. Με αυτό που εγκαθιστά στον προσωπικό υπλογιστή δημιουργεί το project της εφαρμογής και στη συνέχεια στήνει ένα localhost server από το οποίο τροφοδοτείται η κινητή συσκευή. Οποιεσδήποτε αλλαγές στο κώδικα στον υπολογιστή απευθείας εμφανίζονται στην εφαρμογή της κινητής συσκευής και έτσι πραγματοποιείται το κομμάτι της ανάπτυξης.

Για τη δημιουργία του apk, αρκεί ένα απλό upload ζιπαρισμένου του αρχείου που περιέχει τον κώδικα στο adobe build το οποίο αναλαμβάνει όλη την υπόλοιπη διαδικασία μόνο του. Αφού γίνει το build, το apk μπορεί να γίνει download είτε να εγκατασταθεί αυτόματα στην κινητή συσκευή με το σκανάρισμα ενός qr code.

* Εμφάνιση μήκους μονοπατιού

Για την δυνατότητα υπολογισμού του μήκους κάθε μονοπατιού χρησιμοποιήθηκε μια βιβλιοθήκη της google, η geometry. Αυτή, με τη χρήση μιας συνάρτησης που παίρνει σαν παραμέτρους 2 συντεταγμένες υπολογίζει την απόσταση μεταξύ τους. Έτσι αν αυτό γίνει επαναληπτικά για όλες τις συντεταγμένες κάθε μονοπατιού, και η απόσταση αυτή αθροίζεται, εν τέλη έχουμε την συνολική απόσταση του μονοπατιού. Η απόσταση του μονοπατιού μπορεί να εμφανιστεί στο χρήστη με αριστερό κλικ πάνω στο μονοπάτι της επιθυμίας του.

* Περιορισμός 100 μέτρων.

Εφόσον από το πρώτο ζητούμενο του πρώτο παραδοτέου έχουμε τις συντεταγμένες του κέντρου, μπορούμε να δημιουργήσουμε-σχεδιάσουμε ένα κύκλο γύρω από αυτό. Ο συγκεκριμένος κύκλος έχει διάμετρο 100 μέτρων. Εντός του κύκλου ο χρήστης μπορεί να σχεδιάσει ένα καινούριο μονοπάτι. Αν όμως το μονοπάτι σχεδιαστεί εκτός του κύκλου, όταν ο κύκλος αλλάξει θέση ή όταν ο χρήστης επιθυμεί να αποθηκεύσει το σκορ του, το μονοπάτι διαγράφεται και δε λαμβάνεται υπ' όψη. 

Κάθε φορά που γίνεται κλικ οπουδήποτε επάνω στο χάρτη υπολογίζονται οι συντεταγμένες του σημείου που έγινε το κλικ. Αμέσως μετά πυροδοτείται η επανασχεδίαση του κύκλου με συντεταγμένες αυτές του σημείου που κλίκαρε ο χρήστης.

* Log in & score tracking

Τέλος, αν ο χρήστης έχει σχεδιάσει έγκυρα μονοπάτια ( εντός του κύκλου ) τότε μπορεί να καταγράψει και το όνομα του και να αποθηκεύσει το score του στη βάση μας. Το σκορ υπολογίζεται από τη συνολική απόσταση όλων των μονοπατιών που σχεδιάστηκαν.

Επίσης, στο nav menu του web app υπάρχει ζωντανή κατάταξη των παιχτών.

# Προβλήματα που αντιμετωπίστηκαν

Όπως αναφέρθηκε εν συντομία παραπάνω, παρουσιάστηκε πρόβλημα με τη λειτουργία της εφαρμογής στη κινητή συσκευή. Ενώ η λειτουργία του API και της βάσης παραμένουν άθικτα παύει να λειτουργεί το geojson. Μάλιστα, κατά τη λειτουργία του apk δεν εμφανίζεται ούτε ο χάρτης. Προσπάθησα αρκετά να βρω τι φταίει αλλά δε μπόρεσα να βρω κάποιο αντίστοιχο documentation για να με καθοδηγήσει όυτε βρήκα κάποια αντίστοιχη συζήτηση στο διαδίκτυο για recreation του ίδιου issue. Πιο κατανοητά θα γίνουν τα προβλήματα παρακάτω όπου υπάρχουν τα sreenshots

# Screenshots 

![screenshot1](screenshot1.png)
- - - - 
![screenshot2](screenshot2.png)
- - - - 
![screenshot3](screenshot3.png)
- - - - 

Στα παραπάνω φαίνεται η κατάσταση της εφαρμογής κατά την ανάπτυξη της. Τα μονοπάτια δε φορτώνουν διότι δε φορτώνει και το geojson.
Η firebase δεν χάνει κανένα κομμάτι της λειτουργικότητας της.
Αντιθέτως στο apk δε λειτουργεί τίποτα. Για αυτό το λόγω και δεν επισυνάπτω το εκτελέσιμο

![screenshot4](screenshot4.png)
- - - -
![screenshot5](screenshot5.png)

# Πήγες
https://developers.google.com/maps/documentation/javascript/tutorial

https://developers.google.com/maps/documentation/javascript/examples/polyline-simple

https://developers.google.com/maps/documentation/javascript/examples/circle-simple

https://developers.google.com/maps/documentation/javascript/geometry

https://firebase.google.com/

https://firebase.google.com/docs/web/setup

https://material.io/design/

https://stackoverflow.com/




